<div class="profile-container">
  <!-- Header -->
  <div class="profile-header">
    <button class="back-button" routerLink="/levels">
      <span><i class="fa-solid fa-arrow-left"></i></span> Volver a Niveles
    </button>
    <h1 class="profile-title">Mi Perfil</h1>
  </div>

  <!-- Card de Perfil -->
  <div class="profile-card">
    <!-- Avatar Section -->
    <div class="avatar-section">
      <div class="avatar">
        {{ username.charAt(0).toUpperCase() }}
      </div>
      <h2 class="username">{{ username }}</h2>
    </div>

    <!-- Información del Usuario -->
    <div class="user-info-section" *ngIf="!isEditing">
      <div class="info-item">
        <span class="info-label"><i class="fa-solid fa-envelope"></i> Email:</span>
        <span class="info-value">{{ email }}</span>
      </div>
      <div class="info-item">
        <span class="info-label"><i class="fa-solid fa-trophy"></i> Puntuación Total:</span>
        <span class="info-value">{{ totalScore }}</span>
      </div>
      <div class="info-item">
        <span class="info-label"><i class="fa-solid fa-gamepad"></i> Niveles Jugados:</span>
        <span class="info-value">{{ gamesPlayed }}</span>
      </div>
      <div class="info-item">
        <span class="info-label"><i class="fa-solid fa-chart-line"></i> Promedio por Nivel:</span>
        <span class="info-value">{{ averageScore }}</span>
      </div>
      <div class="info-item">
        <span class="info-label"><i class="fa-solid fa-calendar-day"></i> Desafío Diario:</span>
        <span class="info-value" [class.completed]="dailyCompleted">
          <ng-container *ngIf="dailyCompleted"><i class="fa-solid fa-check-circle"></i> Completado Hoy</ng-container>
          <ng-container *ngIf="!dailyCompleted"><i class="fa-solid fa-hourglass-half"></i> Pendiente</ng-container>
        </span>
      </div>

      <button class="edit-button" (click)="toggleEdit()">
        <i class="fa-solid fa-pen-to-square"></i> Editar Perfil
      </button>
    </div>

    <!-- Formulario de Edición -->
    <div class="edit-section" *ngIf="isEditing">
      <div class="info-item" style="margin-bottom: 1rem;">
        <span class="info-label"><i class="fa-solid fa-envelope"></i> Email:</span>
        <span class="info-value">{{ email }}</span>
      </div>

      <div class="form-group">
        <label for="editUsername">Nuevo Nombre de Usuario (opcional):</label>
        <input type="text" id="editUsername" [(ngModel)]="editUsername" placeholder="Mínimo 3 caracteres" minlength="3">
      </div>

      <div class="form-group">
        <label for="editPassword">Nueva Contraseña (opcional):</label>
        <input type="password" id="editPassword" [(ngModel)]="editPassword" placeholder="Mínimo 6 caracteres">
      </div>

      <div class="form-group">
        <label for="editPasswordConfirm">Confirmar Contraseña:</label>
        <input type="password" id="editPasswordConfirm" [(ngModel)]="editPasswordConfirm"
          placeholder="Repite la contraseña">
      </div>

      <div class="edit-actions">
        <button class="save-button" (click)="saveChanges()">
          <i class="fa-solid fa-floppy-disk"></i> Guardar Cambios
        </button>
        <button class="cancel-button" (click)="cancelEdit()">
          <i class="fa-solid fa-xmark"></i> Cancelar
        </button>
      </div>
    </div>

    <!-- Mensajes -->
    <div *ngIf="successMessage" class="success-message">
      <i class="fa-solid fa-check-circle"></i> {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="error-message">
      <i class="fa-solid fa-triangle-exclamation"></i> {{ errorMessage }}
    </div>
  </div>

  <!-- Estadísticas Rápidas -->
  <div class="stats-section">
    <h3>Estadísticas</h3>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon"><i class="fa-solid fa-music"></i></div>
        <div class="stat-label">Niveles Jugados</div>
        <div class="stat-value">{{ gamesPlayed }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fa-solid fa-star"></i></div>
        <div class="stat-label">Puntuación Total</div>
        <div class="stat-value">{{ totalScore }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fa-solid fa-chart-simple"></i></div>
        <div class="stat-label">Promedio</div>
        <div class="stat-value">{{ averageScore }}</div>
      </div>
    </div>
  </div>

  <!-- Spotify Connection Status -->
  <div class="spotify-status" *ngIf="!isEditing">
    <div class="status-header">
      <h3><i class="fa-brands fa-spotify"></i> Estado de Spotify</h3>
      <span class="status-badge" [class.connected]="isSpotifyConnected" [class.disconnected]="!isSpotifyConnected">
        <ng-container *ngIf="isSpotifyConnected"><i class="fa-solid fa-check-circle"></i> Conectado</ng-container>
        <ng-container *ngIf="!isSpotifyConnected"><i class="fa-solid fa-circle-xmark"></i> No conectado</ng-container>
      </span>
    </div>

    <p *ngIf="!isSpotifyConnected" class="warning-text">
      <i class="fa-solid fa-triangle-exclamation"></i> Debes conectar Spotify para poder jugar
    </p>

    <button *ngIf="!isSpotifyConnected" class="spotify-connect-btn" (click)="connectSpotify()">
      <span class="spotify-icon"><i class="fa-brands fa-spotify"></i></span>
      Conectar con Spotify
    </button>

    <button *ngIf="isSpotifyConnected" class="spotify-disconnect-btn" (click)="disconnectSpotify()">
      Desconectar Spotify
    </button>
  </div>

  <!-- Acciones -->
  <div class="actions-section">
    <button class="action-button" (click)="goToLevels()">
      <i class="fa-solid fa-gamepad"></i> Jugar
    </button>
    <button class="action-button" (click)="goToRanking()">
      <i class="fa-solid fa-trophy"></i> Ver Ranking
    </button>
    <button class="action-button logout" (click)="logout()">
      <i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión
    </button>
  </div>
</div>