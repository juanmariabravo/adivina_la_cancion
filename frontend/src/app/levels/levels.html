<div class="levels-container">
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-brand">
            <a routerLink="/" class="brand-link">
                <span class="brand-icon"><i class="fa-solid fa-music"></i></span>
                <span class="brand-text">Adivina la Canción</span>
            </a>
        </div>

        <div class="nav-actions">
            <button class="nav-btn profile-btn" (click)="goToProfile()" [disabled]="isGuest" [class.disabled]="isGuest">
                <span class="btn-icon"><i class="fa-solid fa-user"></i></span>
                <span class="btn-text">{{username}}</span>
            </button>

            <button class="nav-btn ranking-btn" (click)="goToRanking()">
                <span class="btn-icon"><i class="fa-solid fa-trophy"></i></span>
                <span class="btn-text">Ranking</span>
            </button>

            <button class="nav-btn logout-btn" (click)="isGuest ? goToLogin() : logout()">
                <span class="btn-icon"><i class="fa-solid" [class.fa-rocket]="isGuest"
                        [class.fa-right-from-bracket]="!isGuest"></i></span>
                <span class="btn-text">{{ isGuest ? 'Iniciar Sesión' : 'Cerrar Sesión' }}</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="levels-content">
        <!-- Welcome Section -->
        <section class="welcome-section">
            <div class="welcome-card">
                <h1 class="welcome-title">¡Hola, {{username}}!</h1>
                <p class="welcome-subtitle">Elige un nivel y comienza a jugar</p>
                <div class="user-stats">
                    <div class="stat-item" *ngIf="!isGuest">
                        <span class="stat-value">{{totalScore}}</span>
                        <span class="stat-label">Puntos Totales</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{levelsCompleted}}</span>
                        <span class="stat-label">Niveles Completados</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Daily Challenge Section -->
        <section class="daily-section">
            <h2 class="section-title">Desafío Diario</h2>
            <div class="daily-card" (click)="startDailyChallenge()">
                <div class="daily-header">
                    <div class="daily-icon"><i class="fa-solid fa-calendar-day"></i></div>
                    <div class="daily-info">
                        <h3 class="daily-title">Canción del Día</h3>
                        <p class="daily-description">Nueva canción cada 24 horas</p>
                    </div>
                    <div class="daily-badge" *ngIf="!dailyCompleted">NUEVO</div>
                    <div class="daily-badge completed" *ngIf="dailyCompleted">COMPLETADO</div>
                </div>
                <div class="daily-details">
                    <div class="detail-item">
                        <span class="detail-text">Quedan {{timeRemaining.split(':')[0]}}h
                            {{timeRemaining.split(':')[1]}}m {{timeRemaining.split(':')[2]}}s para el nuevo nivel
                            diario</span>
                    </div>
                </div>
                <div class="daily-action">
                    <button class="play-button daily-play">
                        <span class="play-icon"><i class="fa-solid fa-gamepad"></i></span>
                        <span class="play-text"> Jugar Ahora</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Levels Grid -->
        <section class="levels-section">
            <h2 class="section-title">Niveles Disponibles</h2>

            <!-- Aviso de Spotify requerido -->
            <div class="spotify-warning" *ngIf="showSpotifyWarning && !isGuest">
                <div class="warning-content">
                    <h2><i class="fa-brands fa-spotify"></i> Conexión con Spotify Requerida</h2>
                    <p><strong>Importante:</strong> Debes usar el <u>mismo email</u> que tu cuenta de Spotify</p>
                    <p>Tu email registrado: <strong>{{ email }}</strong></p>
                    <button class="connect-spotify-btn" (click)="connectSpotify()">
                        Conectar con Spotify
                    </button>
                </div>
            </div>

            <!-- Grid dinámico de niveles -->
            <div class="levels-grid-modern">
                <div *ngFor="let level of levels; let i = index" class="level-card-modern"
                    [class.completed]="level.completed" [class.locked]="isGuest && level.id > 10"
                    [class.easter-egg]="level.id === -1" (click)="startLevel(level.id)"
                    [title]="isGuest && level.id > 10 ? 'Inicia sesión para desbloquear este nivel' : ''">
                    <!-- Badge de nivel -->
                    <div class="level-number" [class.easter-number]="level.id === -1">
                        <ng-container *ngIf="level.id === -1"><i class="fa-solid fa-ring"></i></ng-container>
                        <ng-container *ngIf="level.id !== -1">{{ level.id }}</ng-container>
                    </div>

                    <!-- Estado -->
                    <div class="level-status">
                        <span *ngIf="level.completed" class="status-completed"><i class="fa-solid fa-check-circle"></i>
                            COMPLETADO</span>
                        <span *ngIf="level.played && !level.completed" class="status-played"><i
                                class="fa-solid fa-play-circle"></i> JUGADO</span>
                        <span *ngIf="isGuest && level.id > 10" class="status-locked"><i
                                class="fa-solid fa-lock"></i></span>
                    </div>

                    <!-- Contenido -->
                    <div class="level-content">
                        <h3 class="level-name">{{ level.title }}</h3>
                        <p class="level-desc" *ngIf="level.description">{{ level.description }}</p>

                        <!-- Dificultad -->
                        <div class="difficulty-badge" [attr.data-difficulty]="level.difficulty.toLowerCase()">
                            {{ level.difficulty }}
                        </div>
                    </div>

                    <!-- Botón de jugar -->
                    <button class="play-level-btn" *ngIf="!isGuest || level.id <= 10 || level.id === -1">
                        <span class="play-icon"><i class="fa-solid fa-play"></i></span>
                    </button>
                </div>
            </div>
        </section>
    </main>
</div>