<div class="game-container">
  <div class="game-header">
    <button class="back-button" (click)="goToLevels()">‚Üê Volver</button>
    <h1>Nivel {{ level_number }}</h1>
    <div class="attempts">Intento {{ currentAttempt }}/{{ maxAttempts }}</div>
  </div>

  <div class="game-content" *ngIf="currentSong && !gameOver">
    <!-- Error de audio -->
    <div class="audio-error" *ngIf="audioError">
      ‚ö†Ô∏è {{ audioError }}
      <button class="retry-btn" (click)="startAudioManually()">Reintentar</button>
    </div>

    <!-- Imagen con reveal progresivo -->
    <div class="image-container">
      <img [src]="currentSong.image_url" [class]="'reveal-' + imageQuarters" alt="Album cover">
    </div>

    <!-- Pistas textuales -->
    <div class="hints-container">
      <div class="hint" *ngIf="revealedHints.includes('year')">
        A√±o: {{ currentSong.year }}
      </div>
      <div class="hint" *ngIf="revealedHints.includes('genre')">
        G√©nero: {{ currentSong.genre }}
      </div>
      <div class="hint" *ngIf="revealedHints.includes('album')">
        √Ålbum: {{ currentSong.album }}
      </div>
      <div class="hint" *ngIf="revealedHints.includes('artist')">
        Artista/s: {{ currentSong.artists }}
      </div>
      <div class="hint" *ngIf="revealedHints.includes('title_hint')">
        El t√≠tulo empieza con: {{ currentSong.title_hint }}...
      </div>
    </div>

      <!-- Bot√≥n para iniciar el juego -->
    <div class="audio-start" *ngIf="audioReady && !gameStarted">
      <button class="play-audio-btn" (click)="startAudioManually()">
        ‚ñ∂ Comenzar
      </button>
    </div>

    <!-- Controles de audio (solo cuando el juego ha comenzado) -->
    <div class="audio-controls" *ngIf="gameStarted && !gameOver">
      <button 
        class="replay-audio-btn" 
        (click)="replayAudio()"
        [disabled]="!canReplayAudio"
        [class.disabled]="!canReplayAudio"
      >
        üîÅ
      </button>
    </div>

    <!-- Input respuesta (deshabilitado hasta que comience) -->
      <input 
        type="text" 
        [(ngModel)]="userAnswer" 
        placeholder="¬øCu√°l es el t√≠tulo de la canci√≥n?"
        (keyup.enter)="submitAnswer()"
      >
      <button 
        class="submit-btn" 
        (click)="submitAnswer()"
        [disabled]="!gameStarted || gameOver"
      >
        Responder
      </button>
      <button 
        class="hint-btn" 
        (click)="nextHint()" 
        *ngIf="currentAttempt < maxAttempts"
        [disabled]="!gameStarted || gameOver"
      >
        Siguiente Pista
      </button>
      <button 
        class="give-up-btn" 
        (click)="giveUp()" 
        *ngIf="currentAttempt === maxAttempts"
      >
        Me rindo
      </button>

    <div class="message" *ngIf="message">{{ message }}</div>
  </div>

  <!-- Pantalla de resultado -->
  <div class="result-screen" *ngIf="gameOver">
    <div class="result-card" [class.correct]="isCorrect" [class.incorrect]="!isCorrect">
      <h2>{{ isCorrect ? '¬°Correcto!' : 'Fin del Juego' }}</h2>
      <p class="result-message">{{ message }}</p>
      
      <div class="song-reveal" *ngIf="showAnswer">
        <img [src]="currentSong!.image_url" alt="Portada" class="reveal-image">
        <h3>{{ currentSong!.title }}</h3>
        <p>{{ currentSong!.artists }}</p>
        <p class="album">{{ currentSong!.album }} ({{ currentSong!.year }})</p>
      </div>

      <div class="score-display" *ngIf="isCorrect">
        <h3>Puntuaci√≥n: {{ score }} puntos</h3>
        <p>Intentos: {{ currentAttempt }}/{{ maxAttempts }}</p>
      </div>

      <div class="result-actions">
        <button class="action-btn primary" (click)="playAgain()">
          Jugar de Nuevo
        </button>
        <button class="action-btn secondary" (click)="goToLevels()">
          Volver a Niveles
        </button>
      </div>
    </div>
  </div>
</div>