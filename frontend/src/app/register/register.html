<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - Adivina la Canción</title>
</head>

<body>
    <div class="register-container">
        <!-- Background con efecto musical -->
        <div class="background-effects">
            <div class="floating-note"><i class="fa-solid fa-music"></i></div>
            <div class="floating-note"><i class="fa-solid fa-headphones"></i></div>
            <div class="floating-note"><i class="fa-solid fa-music"></i></div>
            <div class="floating-note"><i class="fa-solid fa-headphones"></i></div>
        </div>

        <!-- Card de registro -->
        <div class="register-card">
            <!-- Header -->
            <div class="card-header">
                <a routerLink="/" class="back-button">
                    <span class="back-arrow"><i class="fa-solid fa-arrow-left"></i></span>
                    Volver al inicio
                </a>
                <div class="logo-section">
                    <div class="logo"><i class="fa-solid fa-music"></i></div>
                    <h1>Crear Cuenta</h1>
                    <p>Únete a la comunidad musical</p>
                </div>
            </div>

            <!-- Formulario -->
            <form class="register-form" id="registerForm" (ngSubmit)="onRegister()" #registerForm="ngForm" novalidate>

                <!-- Username -->
                <div class="form-group">
                    <label for="username">Nombre de usuario</label>
                    <div class="input-container" [class.error]="usernameInvalid">
                        <input type="text" id="username" [(ngModel)]="username" name="username"
                            placeholder="Elige tu nombre de usuario" required minlength="3" maxlength="20"
                            (blur)="validateUsername()" #usernameInput="ngModel">
                        <span class="input-icon"><i class="fa-solid fa-user"></i></span>
                    </div>
                    <div class="error-message" *ngIf="usernameInvalid">
                        <span *ngIf="usernameError">{{ usernameError }}</span>
                    </div>
                </div>

                <!-- Email -->
                <div class="form-group">
                    <label for="email">Email</label>
                    <div class="input-container" [class.error]="emailInvalid">
                        <input type="email" id="email" [(ngModel)]="email" name="email"
                            placeholder="Introduce tu correo" required email (blur)="validateEmail()"
                            #emailInput="ngModel">
                        <span class="input-icon"><i class="fa-solid fa-envelope"></i></span>
                    </div>
                    <div class="error-message" *ngIf="emailInvalid">
                        <span *ngIf="emailInput.errors?.['required']">El email es requerido</span>
                        <span *ngIf="emailError">{{ emailError }}</span>
                    </div>
                </div>

                <!-- Password -->
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <div class="input-container" [class.error]="passwordInvalid">
                        <input [type]="showPassword ? 'text' : 'password'" id="password" [(ngModel)]="pwd1"
                            name="password" placeholder="Crea una contraseña segura" required minlength="6"
                            #passwordInput="ngModel">
                        <button type="button" class="toggle-password" (click)="togglePasswordVisibility()"
                            [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
                            <i class="fa-solid" [class.fa-eye-slash]="showPassword" [class.fa-eye]="!showPassword"></i>
                        </button>
                    </div>
                    <div class="error-message" *ngIf="passwordInvalid">
                        <span *ngIf="passwordInput.errors?.['required']">La contraseña es requerida</span>
                        <span *ngIf="passwordInput.errors?.['minlength']">Mínimo 6 caracteres</span>
                    </div>

                    <!-- Indicador de fuerza de contraseña -->
                    <div class="password-strength" *ngIf="pwd1.length > 0">
                        <div class="strength-bar">
                            <div class="strength-fill" [class]="passwordStrengthClass"></div>
                        </div>
                        <span class="strength-text">{{ passwordStrengthText }}</span>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div class="form-group">
                    <label for="confirmPassword">Confirmar contraseña</label>
                    <div class="input-container" [class.error]="confirmPasswordInvalid">
                        <input [type]="showPassword ? 'text' : 'password'" id="confirmPassword" [(ngModel)]="pwd2"
                            name="confirmPassword" placeholder="Repite tu contraseña" required
                            (input)="validateConfirmPassword()" #confirmPasswordInput="ngModel">
                        <span class="input-icon"><i class="fa-solid fa-check-circle"></i></span>
                    </div>
                    <div class="error-message" *ngIf="confirmPasswordInvalid">
                        <span *ngIf="confirmPasswordInput.errors?.['required']">Confirma tu contraseña</span>
                        <span *ngIf="confirmPasswordError">{{ confirmPasswordError }}</span>
                    </div>
                </div>

                <!-- Spotify Client ID -->
                <div class="form-group">
                    <label for="spotifyClientId">
                        Spotify Client ID *
                    </label>
                    <div class="input-container" [class.error]="spotifyClientIdInvalid">
                        <input type="text" id="spotifyClientId" [(ngModel)]="spotifyClientId" name="spotifyClientId"
                            placeholder="Tu Client ID de Spotify" required (blur)="validateSpotifyClientId()"
                            #spotifyClientIdInput="ngModel">
                        <span class="input-icon"><i class="fa-brands fa-spotify"></i></span>
                    </div>
                    <div class="error-message" *ngIf="spotifyClientIdInvalid">
                        <span *ngIf="spotifyClientIdInput.errors?.['required']">El Client ID de Spotify es
                            requerido</span>
                        <span *ngIf="spotifyClientIdError">{{ spotifyClientIdError }}</span>
                    </div>
                </div>

                <!-- Spotify Client Secret -->
                <div class="form-group">
                    <label for="spotifyClientSecret">
                        Spotify Client Secret *
                    </label>
                    <div class="input-container" [class.error]="spotifyClientSecretInvalid">
                        <input type="password" id="spotifyClientSecret" [(ngModel)]="spotifyClientSecret"
                            name="spotifyClientSecret" placeholder="Tu Client Secret de Spotify" required
                            (blur)="validateSpotifyClientSecret()" #spotifyClientSecretInput="ngModel">
                        <span class="input-icon"><i class="fa-solid fa-key"></i></span>
                    </div>
                    <div class="error-message" *ngIf="spotifyClientSecretInvalid">
                        <span *ngIf="spotifyClientSecretInput.errors?.['required']">El Client Secret de Spotify es
                            requerido</span>
                        <span *ngIf="spotifyClientSecretError">{{ spotifyClientSecretError }}</span>
                    </div>
                    <details class="help-details">
                        <summary>¿Cómo obtener mis credenciales de Spotify?</summary>
                        <div class="help-content">
                            <ol>
                                <li>Ve a <a href="https://developer.spotify.com/dashboard" target="_blank">Spotify
                                        Developer Dashboard</a></li>
                                <li>Inicia sesión con tu cuenta de Spotify</li>
                                <li>Haz clic en "Create an App"</li>
                                <li>Completa el formulario con el nombre de tu aplicación</li>
                                <li>En la configuración de la app, añade esta URL de redirección:
                                    <code>http://127.0.0.1:4200/callback</code>
                                </li>
                                <li>Copia el Client ID y Client Secret y pégalos aquí</li>
                            </ol>
                        </div>
                    </details>
                </div>

                <!-- Mensajes de error general -->
                <div *ngIf="formError" class="error-message general-error">
                    {{ formError }}
                </div>

                <!-- Mensaje de éxito -->
                <div *ngIf="successMessage" class="success-message">
                    <div class="success-content">
                        <span class="success-icon"><i class="fa-solid fa-check-circle"></i></span>
                        <span class="success-text">{{ successMessage }}</span>
                    </div>
                </div>

                <!-- Botón de registro -->
                <button type="submit" class="submit-button" [disabled]="loading || !isFormValid()">
                    <span class="button-text">
                        {{ loading ? 'Creando cuenta...' : 'Crear Cuenta' }}
                    </span>
                    <div *ngIf="loading" class="loading-spinner"></div>
                </button>
            </form>

            <!-- Footer del card -->
            <div class="card-footer">
                <p>¿Ya tienes una cuenta? <a routerLink="/login" class="auth-link">Inicia sesión aquí</a></p>
            </div>
        </div>
    </div>
</body>

</html>